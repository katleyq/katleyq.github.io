{
  "hash": "bcdf932ee789e1c854dd1f202a3978a8",
  "result": {
    "markdown": "---\ntitle: \"Factors influencing algal growth in aquatic systems\"\ndescription: \"Predicting algal blooms using NTL LTER data\"\nauthor: \"Kat Le\"\ndate: \"Dec 15, 2023\"\nformat: pdf\nbibliography: references.bib\n---\n\n\n## Background & Motivation\n\nAlgal blooms are defined as the rapid growth of tiny photosynthetic organisms in aquatic environments. Blooms can last for a few days to a few weeks, and sometimes, they can persist for months[@sellner2003]. Algal blooms can be beneficial for removing carbon dioxide from the atmosphere, but the long-term impact of these blooms can be far more detrimental for aquatic ecosystems[@grattan2016]. These photosynthetic organisms can release neurotoxins that are harmful for most living organisms, and they can eventually create oxygen dead zones by being a source of nutrients for microbes [@misra2011].\n\nThis project is motivated by my time living and working in Pennsylvania. In the summer of 2019, I saw my first algal bloom occur in Lake Arrowhead, PA (pictured below). I was curious because it looked like someone had poured paint into the lake. I learned from local residents that these blooms are actually phytoplankton and that they have been seeing these blooms happen more frequently in lakes in the Poconos. In their experience, these blooms last a few days and often times, it will cause dead fish to float to the surface. This made me curious about what factors influence the occurrence of these algal blooms.\n\n![Lake Arrowhead, PA. July 2019.](images/IMG_5340.JPG){fig-align=\"center\"}\n\n## Question\n\nFor this project, I am interested in the effects of available nutrients, water temperature, and light on predicting algal growth. In addition, I want to explore whether a change in depth, nutrients, and water temperature increases the odds that an algal bloom occurs within a lake. Finally, I want to assess the long-term trend of chlorophyll concentration in the core study lakes over the past 4 decades.\n\n## Data Source\n\nI used data collected by the [North Temperate Lakes LTER](https://lter.limnology.wisc.edu/) and stored in the [Environmental Data Initiative](https://portal.edirepository.org/nis/home.jsp) (EDI) repository. I utilized data from 7 study lakes in Northern Wisconsin, where NTL LTER has been collecting data since 1981 until December 2022. The sites I chose were the study sites with the longest-running data: Crystal Bog, Trout Bog, Crystal Lake, Big Muskellunge, Sparking Lake, Allequash Lake, and Trout Lake. These lakes vary in physical dimensions, sources of water, shoreline development, and elevation.\n\n|                         | Crystal Bog | Trout Bog | Crystal Lake | Big Muskellunge | Sparking Lake | Allequash Lake | Trout Lake |\n|---------|---------|---------|---------|---------|---------|---------|---------|\n| *Latitude*              | 46.008      | 46.041    | 46.003       | 46.021          | 46.008        | 46.038         | 46.029     |\n| *Longitude*             | -89.606     | -89.686   | -89.612      | -89.612         | -89.701       | -89.621        | -89.665    |\n| *Area (ha)*             | 0.6         | 1         | 37.5         | 363.4           | 63.7          | 164.2          | 1565.1     |\n| *Depth (m)*             | 2.5         | 7.9       | 20.4         | 21.3            | 20            | 8              | 35.7       |\n| *Shoreline Length (km)* | 0.285       | 0.369     | 2.3          | 16.1            | 4.3           | 9.5            | 25.9       |\n\n![Core Study Lakes, North Temperate Lake LTER.](images/Screenshot%202023-12-14%20at%2012.32.18%20PM.png){fig-align=\"center\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(tsibble)\nlibrary(feasts)\nlibrary(forecast)\nlibrary(zoo) # na.approx\nlibrary(patchwork)\nlibrary(broom)\nlibrary(gt) \nlibrary(kableExtra)\nlibrary(car)\nlibrary(sjPlot)\nlibrary(caret)\n\n# lake_chemistry cleaning\nlake_chem_clean <- read_csv(\"/Users/katle/Desktop/Desktop - kat’s MacBook Air/MEDS/EDS_222/github/eds222-final/data/chemical_limnology.csv\") %>% \n  group_by(lakeid, sampledate) %>% \n  filter(lakeid %in% c(\"AL\", \"BM\", \"CB\", \"CR\", \"SP\", \"TB\", \"TR\")) %>% \n  select(c(\"lakeid\", \"sampledate\", \"depth\", \"ph\", \"dic\",\n           \"doc\", \"no3no2\", \"nh4\"))\n\nchlorophyll_clean <- read_csv(\"/Users/katle/Desktop/Desktop - kat’s MacBook Air/MEDS/EDS_222/github/eds222-final/data/troutlake_chlorophyll.csv\") %>% \n  select(!c(\"year4\", \"daynum\", \"rep\", \"sta\", \"phaeo\", \"flagphaeo\", \"flagchlor\"))\n\nlake_phys <- read_csv(\"/Users/katle/Desktop/Desktop - kat’s MacBook Air/MEDS/EDS_222/github/eds222-final/data/phys_lake.csv\") %>% \n  filter(lakeid %in% c(\"AL\", \"BM\", \"CB\", \"CR\", \"SP\", \"TB\", \"TR\")) %>%\n  select(c(\"lakeid\", \"sampledate\", \"wtemp\", \"o2sat\", \"light\"))\n\nmeteorlogical <- read_csv(\"/Users/katle/Desktop/Desktop - kat’s MacBook Air/MEDS/EDS_222/github/eds222-final/data/meteorlogical.csv\")\n\n# joining chorophyll, lake_chem, and meteorlogical data\njoin_chla_lake_chem <- full_join(chlorophyll_clean, lake_chem_clean,\n                                  by = c(\"lakeid\", \"sampledate\")) \njoin_phys <- full_join(join_chla_lake_chem, lake_phys,\n                       by = c(\"lakeid\", \"sampledate\")) %>%\n  group_by(lakeid, sampledate) %>% \n  summarize(chla = mean(chlor, na.rm = TRUE),\n            no3no2 = mean(no3no2, na.rm = TRUE),\n            nh4 = mean(nh4, na.rm = TRUE),\n            doc = mean(doc, na.rm = TRUE),\n            ph = mean(ph, na.rm = TRUE),\n            wtemp = mean(wtemp, na.rm = TRUE), \n            o2sat = mean(o2sat, na.rm = TRUE),\n            light = mean(light, na.rm = TRUE)) %>% \n  filter(chla > 0,\n         nh4 > 0,\n         light > 0) %>% \n  mutate(depth = case_when(\n    lakeid == \"CB\" ~ 2.5,\n    lakeid == \"TB\" ~ 7.9,\n    lakeid == \"CR\" ~ 20.4,\n    lakeid == \"BM\" ~ 21.3,\n    lakeid == \"SP\" ~ 20,\n    lakeid == \"AL\" ~ 8,\n    lakeid == \"TR\" ~ 35.7\n  )) %>%\n   mutate(bloom = case_when(\n    chla >= 40 ~ TRUE,\n    chla < 40 ~ FALSE\n  ))\n\n\nfull_data <- full_join(join_phys, meteorlogical, by = \"sampledate\") %>% \n  select(c(lakeid, sampledate, depth, bloom, wtemp, o2sat, light, chla, no3no2, nh4, \n           doc, min_air_temp, max_air_temp)) %>% \n  drop_na(lakeid)\n```\n:::\n\n\n## Exploratory analysis\n\nFor the first part of this analysis, I plotted the distribution of ammonium (a readily available nutrient for phytoplankton [@dai2012]), water temperature, light, and depth of a lake. This step indicates to me that I should log-transform nutrient, light and chlorophyll data in order to assume a normal distribution for my linear model.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nchla_dist <- ggplot(data = full_data, aes(x = chla)) +\n  geom_histogram() +\n  labs(title = \"Chlorophyll distribution\",\n       x = bquote(\"Chlorophyll (\"*mu~\"g/mL)\")) +\n  theme_bw()\n\nwtemp_dist <- ggplot(data = full_data, aes(x = wtemp)) +\n  geom_histogram() +\n  labs(title = \"Water temperature distribution\",\n       x = \"Water Temperature (Celsius)\") +\n  theme_bw()\n\nlight_dist <- ggplot(data = full_data, aes(x = light)) +\n  geom_histogram() +\n  labs(title = \"Light distribution\",\n       x = bquote(\"Light (\"*mu~\"mol/m\"^2*\"/s)\")) +\n  theme_bw()\n\nnutrient_dist <- ggplot(data = full_data, aes(x = nh4)) +\n  geom_histogram() +\n  labs(title = \"Nutrient distribution\",\n       x = bquote(\"Ammonium (\"*mu~\"g/mL)\")) +\n  theme_bw()\n\n(nutrient_dist + wtemp_dist) / (light_dist + chla_dist)\n```\n\n::: {.cell-output-display}\n![Nutrient, Water Temperature, Light, and Chlorophyll Histograms](index_files/figure-pdf/unnamed-chunk-2-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n## Methods & Results\n\n### Multiple Linear Model\n\nFor this next step of my analysis, I am building a linear model with 3 predictor variables: nutrient concentration, water temperature, and light availability. The nutrient and light data have been log-transformed to assume a normal distribution. This is how I set up my linear model:\n\n$$ log(chla)=\\beta_0+\\beta_1  log(nutrients) +\\beta_2  (watertemp) + \\beta_3  log(light) + \\varepsilon $$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nmod <- lm(log(chla) ~ log(nh4) + wtemp + log(light), data = full_data)\n```\n:::\n\n\nThis is my model output:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ntab_model(mod,\n          pred.labels = c(\"Intercept\", \"log(NH4)\", \"Water Temp\", \"log(Light)\"),\n          dv.labels = c(\"log(Chlorophyll)\"),\n          string.ci = \"Conf. Int (95%)\",\n          string.p = \"P-value\",\n          title = \"Multiple Linear Model Output\",\n          digits = 4)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Multiple Linear Model Output</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">log(Chlorophyll)</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Estimates</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Conf. Int (95%)</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">P-value</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Intercept</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.5746</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.7803&nbsp;&ndash;&nbsp;-0.3689</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">log(NH4)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.2144</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.1800&nbsp;&ndash;&nbsp;0.2488</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Water Temp</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0951</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0856&nbsp;&ndash;&nbsp;0.1047</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">log(Light)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0993</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0696&nbsp;&ndash;&nbsp;0.1291</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">2827</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> / R<sup>2</sup> adjusted</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.230 / 0.229</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\nNow, I want to assess the validity of my linear model by plotting the residuals:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nres_plot <- plot(fitted(mod), resid(mod),\n     xlab = \"Fitted Values\",\n     ylab = \"Residuals\",\n     main = \"Residuals vs Fitted\") +\n  abline(h = 0, col = \"red\")\n```\n\n::: {.cell-output-display}\n![Plotting residuals to assess model performance](index_files/figure-pdf/unnamed-chunk-5-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\nres_plot\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ninteger(0)\n```\n:::\n:::\n\n\n### Logistic Model\n\nIn this next step of my analysis, I want to look at the odds of an algal bloom occurrence using depth of a lake, ammonium concentration, and water temperature as predictor variables. To do this, I transform chlorophyll concentrations to a binary response variable where 1 is the occurrence of a bloom and 0 is the absence of a bloom. Building off prior research, I am using 40 ug/mL as the detection limit for an algal bloom [@havens1994].\n\n$$\\operatorname{logit}(p)=\\log \\left(\\frac{p}{1-p}\\right)=\\beta_0+\\beta_1  (depth) +\\beta_2  log(nutrients) + \\beta_3  (watertemp) + \\varepsilon $$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlog_mod <- glm(bloom ~ depth + log(nh4) + wtemp, data = full_data, family = \"binomial\")\n\ntab_model(log_mod,\n          pred.labels = c(\"Intercept\", \"depth\", \"log(NH4)\", \"Water Temp\"),\n          dv.labels = c(\"Log odds of Bloom Occurrence\"),\n          string.ci = \"Conf. Int (95%)\",\n          string.p = \"P-value\",\n          title = \"Log-odds of Algal Bloom Presence\",\n          digits = 4)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Log-odds of Algal Bloom Presence</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">Log odds of Bloom Occurrence</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Odds Ratios</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Conf. Int (95%)</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">P-value</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Intercept</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0018</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0005&nbsp;&ndash;&nbsp;0.0057</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">depth</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.8231</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.7908&nbsp;&ndash;&nbsp;0.8531</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">log(NH4)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.1266</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.7945&nbsp;&ndash;&nbsp;2.5406</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Water Temp</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.1991</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.1614&nbsp;&ndash;&nbsp;1.2398</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">2827</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> Tjur</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.209</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\nI transform the log odds ratio into a more intuitive unit, which is the odds ratio of an algal bloom occurrence. The odds ratio is defined here:\n\n$$\n\\operatorname{odds}(\\hat{p})=\\frac{\\hat{p}}{1-\\hat{p}}= exp(\\beta_0+\\beta_1  (depth) + \\varepsilon)\n$$\n\n$$\n\\operatorname{odds}(\\hat{p})=\\frac{\\hat{p}}{1-\\hat{p}}= exp(\\beta_0+\\beta_2  (nutrients) + \\varepsilon)\n$$\n\n$$\n\\operatorname{odds}(\\hat{p})=\\frac{\\hat{p}}{1-\\hat{p}}= exp(\\beta_0+\\beta_3  (watertemp) + \\varepsilon)\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Depth OR Plot\nbloom_predict_depth <- glm(bloom ~ depth, data = full_data, family = \"binomial\") %>%\n  augment(type.predict = \"response\") %>%\n  mutate(y_hat = .fitted) %>% \n  mutate(odds_hat = y_hat / (1 - y_hat))  \n\nOR_depth_plot <- ggplot(bloom_predict_depth, \n                       aes(x = depth, y = odds_hat)) +\n  geom_point() + \n  geom_line() + \n  scale_y_continuous(\"Odds of algal bloom occurence\") +\n  labs(title= \"Odds of Algal Bloom Occurence by depth\",\n       x = \"Depth (m)\") +\n  theme_classic()\n\nOR_depth_plot\n```\n\n::: {.cell-output-display}\n![Odd Ratio of Bloom Occurrence by Depth](index_files/figure-pdf/unnamed-chunk-7-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Ammonium OR Plot\nbloom_predict_nut <- glm(bloom ~ log(nh4), data = full_data, family = \"binomial\") %>%\n  augment(type.predict = \"response\") %>%\n  mutate(y_hat = .fitted) %>% \n  mutate(odds_hat = y_hat / (1 - y_hat))  \n\nOR_nut_plot <- ggplot(bloom_predict_nut, \n                       aes(x = `log(nh4)`, y = odds_hat)) +\n  geom_point() + \n  geom_line() + \n  scale_y_continuous(\"Odds of bloom occurence\") +\n  labs(title= \"Odds of Algal Bloom Occurence by Ammonium Concentration\",\n       x = bquote(\"Log Ammonium (\"*mu~\"g/mL)\")) +\n  theme_classic()\n\n# Water Temperature Plot\nbloom_predict_wat <- glm(bloom ~ wtemp, data = full_data, family = \"binomial\") %>%\n  augment(type.predict = \"response\") %>%\n  mutate(y_hat = .fitted) %>% \n  mutate(odds_hat = y_hat / (1 - y_hat))  \n\nOR_wat_plot <- ggplot(bloom_predict_wat, \n                       aes(x = wtemp, y = odds_hat)) +\n  geom_point() + \n  geom_line() + \n  scale_y_continuous(\"Odds of bloom occurence\") +\n  labs(title= \"Odds of Algal Bloom Occurence by Water Temperature\",\n       x = \"Water Temperature (Celsius)\") +\n  theme_classic()\nOR_wat_plot / OR_nut_plot\n```\n\n::: {.cell-output-display}\n![Odds Ratio of Bloom Occurrence by Ammonium and Water Temperature Data](index_files/figure-pdf/unnamed-chunk-8-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n### Confusion Matrix\n\nNow, I am creating a confusion matrix to assess my model's performance:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nconf_matrix <- log_mod %>%\n  augment(type.predict = \"response\") %>%\n  mutate(y_hat = as.logical(round(.fitted))) %>% \n  select(bloom, .fitted, y_hat) \n\nconf_matrix_fin = confusionMatrix(data = as.factor(conf_matrix$y_hat), \n                                    reference = as.factor(conf_matrix$bloom))\n\ndepth_cm_df <- as.data.frame(as.table(conf_matrix_fin))\n\nkable(depth_cm_df) %>% \n  kable_styling() %>% \n  add_header_above(c(\"Confusion Matrix for Logistic Model\" = 3)) %>% \n  row_spec(seq(1, nrow(depth_cm_df), by = 2), background = \"#D3D3D3\") %>% \n  add_footnote(\"Model performed at a 92.8% accurracy level\")\n```\n\n::: {.cell-output-display}\n\\begin{table}\n\\centering\n\\begin{tabular}{l|l|r}\n\\hline\n\\multicolumn{3}{c}{Confusion Matrix for Logistic Model} \\\\\n\\cline{1-3}\nPrediction & Reference & Freq\\\\\n\\hline\n\\cellcolor[HTML]{D3D3D3}{FALSE} & \\cellcolor[HTML]{D3D3D3}{FALSE} & \\cellcolor[HTML]{D3D3D3}{2598}\\\\\n\\hline\nTRUE & FALSE & 25\\\\\n\\hline\n\\cellcolor[HTML]{D3D3D3}{FALSE} & \\cellcolor[HTML]{D3D3D3}{TRUE} & \\cellcolor[HTML]{D3D3D3}{180}\\\\\n\\hline\nTRUE & TRUE & 24\\\\\n\\hline\n\\multicolumn{3}{l}{\\textsuperscript{a} Model performed at a 92.8\\% accurracy level}\\\\\n\\end{tabular}\n\\end{table}\n\n\n\nTable 4: Confusion Matrix to Assess Logistic Model Performance\n:::\n:::\n\n\n### Decomposition\n\nFinally, I conducted a decomposition analysis to see if there is a long-term trend in chlorophyll concentrations across all of the core study lakes over the past 4 decades.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndecomp <- full_data %>% \n  mutate(year_month = yearmonth(sampledate)) %>% \n  group_by(year_month) %>% \n  summarize(avg_chlor = mean(chla, na.rm = TRUE)) %>% \n  tsibble(index = year_month) %>% \n  tsibble::fill_gaps() %>% \n  mutate(avg_chlor=if_else(is.nan(avg_chlor), NA, avg_chlor) %>% \n        na.approx()) %>% \n  model(classical_decomposition(avg_chlor, type = \"additive\"))\n\nautoplot(components(decomp)) +\n  labs(title = \"Classical Decomposition of Chlorphyll Concentrations Across All Sites\",\n       x = \"Date\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![Classical Decomposition of Chlorophyll Concentrations over past 4 decades](index_files/figure-pdf/unnamed-chunk-10-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n# Discussion\n\nBased on the results of my multiple regression model (Table 2), normalized ammmonium concentration, water temperature, and light conditions can explain 23% of the variance in normalized chlorophyll concentrations in this dataset. One percentage point change in ammonium concentration results in a 0.21 change in normalized chorophyll concentration, holding all other variables constant (p \\< 0.001). Likewise, for every one degree Celsius change in water temperature, the normalized concentration of chlorophyll increases by 0.1 when all other variables are constant (p \\< 0.001). Finally, for every one percentage point change in available light, the normalized chlorophyll concentration increases by 0.1 when all other variables are constant (p \\< 0.001). When the residuals were plotted against the fitted values, there was an even spread of points across the plane, meaning this model met the assumptions of a linear model. Overall, this model could be improved by looking at other factors like wind, groundwater input, and visibility to explain more of the variance in chlorophyll.\n\nBased on the results of my logit model (Table 3), a one meter increase in depth decreased the expected change in log odds of algal bloom occurrence by 0.82 (p \\< 0.001). This means that deeper lakes have less algal blooms. This model also shows that a one percentage point change in ammonium concentration results in an increase in the log odds of algal bloom occurrence by 2.13 (p \\< 0.001). In addition, when water temperature increased by one degree Celsius, the log odds of algal bloom occurrence slightly increased by 1.20 (p \\< 0.001). To assess my logit model's performance, I created a confusion matrix to calculate the amount of true positives, true negatives, false positives, and false negatives (Table 4). To find the accuracy level, I added the count of true positives and true negatives and divided that by the total observations. The accuracy of my model is 92.8%. The confusion matrix shows that this model is better at predicting true negatives than true positives. The accuracy level may be misleading and should be interpreted with caution because the dataset itself is imbalanced in that there are more observations with no blooms than there are true blooms. If the data had more true blooms, then my model might not be as accurate in predicting a bloom.\n\nBased on the results of my decomposition analysis (Figure 7), there has been a slight increase over chlorophyll concentration over time across all sites from 1981-2022. This positive trend is very small though as evidence by the longer grey bar on the left of the trend panel. There is a small seasonal component to chlorophyll concentration across all sites, but most of the variation is explained by random noise in the data as evidenced by the short grey bar in the random panel.\n\n### Conclusion\n\nOverall, ammonium concentration, water temperature, light, and depth all explain some variation in algal biomass. These explanatory variables can also help predict the presence of absence of a bloom, but the model needs to be improved by including more lakes with different depths. Additionally, chlorophyll concentration is slightly increasing over time across all lakes. For future work, I would analyze the effect of turbulence, wind and groundwater input to see if these variables can explain more of the variance in algal growth. I would also analyze the data by site to see if some lakes are increasing more in chlorophyll than others.\n\n# Literature Cited\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "\\usepackage{booktabs}\n\\usepackage{longtable}\n\\usepackage{array}\n\\usepackage{multirow}\n\\usepackage{wrapfig}\n\\usepackage{float}\n\\usepackage{colortbl}\n\\usepackage{pdflscape}\n\\usepackage{tabu}\n\\usepackage{threeparttable}\n\\usepackage{threeparttablex}\n\\usepackage[normalem]{ulem}\n\\usepackage{makecell}\n\\usepackage{xcolor}\n"
      ]
    },
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}