{
  "hash": "10b8fcb48d689c1446c4c09331840f37",
  "result": {
    "markdown": "---\ntitle: \"Species suitability maps for marine aquaculture\"\ndescription: \"Finding suitable locations for marine aquaculture\"\nauthor: \"Kat Le\"\ndate: \"2023-12-14\"\noutput: html_document\nbibliography: references.bib\n---\n\n\n\n\n# Background\n\nOne of the biggest challenges our generation is facing the effects of the Great Acceleration [@steffen2015]. With advancements in technology, humans are living longer, and the population is growing at an exponential rate. In addition, our planet's climate is changing due to the atmosphere is being loaded with greenhouse gases. One outcome of this phenomenon is that we need to meet the food demands of a growing population and we need to do it while limiting our carbon footprint.\n\nMarine aquaculture has the potential to be an important sustainable food source to meet food demands, while limiting our carbon footprint. To build out the marine aquaculture industry, it is important to\\_\n\n# Project Objectives\n\nThis project aims to do the following:\n\n1.  Find optimal locations for aquaculture within West Coast Exclusive Economic Zones using oysters as a model.\n\n2.  Create a species suitability map for oysters of habitable area that displays total suitable area and percent suitable area by West Coast EEZ.\n\n3.  Build a product that outputs a species suitablity map by West Coast EEZs when users input a species name, suitable temperature range, and suitable depth range.\n\n# Data\n\n| Data type                | Source                                                                                                                                                                                                                                                                                                                                                        |\n|----------------|--------------------------------------------------------|\n| Sea Surface Temperature  | I will use average annual sea surface temperature (SST) from the years 2008 to 2012 to characterize the average sea surface temperature within the region. The data I am working with was originally generated from [NOAA's 5km Daily Global Satellite Sea Surface Temperature Anomaly v3.1](https://coralreefwatch.noaa.gov/product/5km/index_5km_ssta.php). |\n| Bathymetry (Depth)       | To characterize the depth of the ocean, I will use the [General Bathymetric Chart of the Oceans (GEBCO)](https://www.gebco.net/data_and_products/gridded_bathymetry_data/#area).[^1]                                                                                                                                                                          |\n| Exclusive Economic Zones | I will be designating maritime boundaries using Exclusive Economic Zones off of the west coast of US from [Marineregions.org](https://www.marineregions.org/eez.php).                                                                                                                                                                                         |\n\n[^1]: GEBCO Compilation Group (2022) GEBCO_2022 Grid (<doi:10.5285/e0f0bb80-ab44-2739-e053-6c86abc0289c>).\n\n# Method\n\nThis section will show the steps I took to complete the objectives above. In additions to the steps, I build in checkpoints along the way to make the debugging process easier when I apply this workflow to other projects.\n\n### Preparing the data\n\nTo start, I'll need to load all the necessary packages and read in our data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(tidyverse)\nlibrary(terra)\nlibrary(sf)\nlibrary(patchwork)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in west coast eez shapefile\nwc_eez <- st_read(\"/Users/katle/Desktop/Desktop - kat’s MacBook Air/github/species-habitability-maps/data/wc_regions_clean.shp\")\n\n# create list of files\nsst_list <- list.files(here(\"/Users/katle/Desktop/Desktop - kat’s MacBook Air/github/species-habitability-maps/data/\"), pattern = \"average*\", full.names = TRUE)\n\n# read in landsat data from 2008-2012 as a raster stack and project it into 4326 \nall_sst <- rast(here(sst_list)) %>% \n  project(\"EPSG:4326\")\n\n# clean column names\nnames(all_sst) = c(\"SST_2008\", \"SST_2009\", \"SST_2010\", \"SST_2011\", \"SST_2012\")\n\n# read in bathymetry data\nbathymetry <- rast(\"/Users/katle/Desktop/Desktop - kat’s MacBook Air/github/species-habitability-maps/data/depth.tif\")\n```\n:::\n\n\n### Processing Data\n\nNow that we have our West Coast EEZ regions, SST, and depth data loaded, we can begin process the data. I'll need to convert the temperature to Celsius, crop the data, and resample so that we have matching resolutions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# find the mean sst from 2008-2012 then convert from kelvin to celsius\nmean_sst_celsius <- terra::app(all_sst, mean) - 273.15\n\n# crop bathymetry data to include area covered in mean_sst_celsius\nbathymetry_cropped <- terra::crop(bathymetry, mean_sst_celsius)\n\n# resample depth data to match resolution of all_sst using nearest neighbors approach\nbathymetry_cropped <- terra::resample(bathymetry_cropped, mean_sst_celsius, method = 'near')\n```\n:::\n\n\n### Finding suitable locations\n\nIn order to find suitable locations for marine aquaculture, I'll need to find locations that are suitable in terms of both SST and depth. The first step is to create two reclassification matrices for SST and depth, where I assign a value of 1 to suitable cells and NA to unsuitable cells. Then I'll reclassify both rasters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##### sst reclassification\n# create reclassification matrix that assigns 1 to suitable values and NA to unsuitable values\ntemp_rcl <- matrix(c(-Inf, 11, NA,\n                      11, 30, 1,\n                      30 , Inf, NA), \n               ncol = 3, byrow = TRUE)\n\n# re-classify mean_sst with matrix above\nmean_sst_reclassified <- classify(mean_sst_celsius, rcl = temp_rcl)\n\n##### depth reclassification\n# create reclassification matrix for bathymetry data\ndepth_rcl <- matrix(c(-Inf, -70, NA,\n                      -70, 0, 1,\n                       0, Inf, NA), \n               ncol = 3, byrow = TRUE)\n\n# re-classify bathymetry_cropped with matrix above\ndepth_reclassified <- classify(bathymetry_cropped, rcl = depth_rcl)\n```\n:::\n\n\nNow, I'll create a basic function that will multiple two objects. In this case, I will be multiplying the SST and depth rasters. This will return a single raster with cells that have 1 where SST and depth conditions are suitable, and NAs where they are not suitable.\n\n\n::: {.cell inclue='true'}\n\n```{.r .cell-code}\n# create a function to return 1 where mean_sst_reclassified and depth_reclassified are both in suitable conditions\nsuitability_fun <- function(sst, depth) {\n  return(sst*depth)\n  }\n\n# apply function to oyster suitability raster stack\noyster_suitability <- lapp(c(mean_sst_reclassified, depth_reclassified), fun = suitability_fun)\n```\n:::\n\n\n### Determining the most suitable West Coast EEZ\n\nIn this next step, I want to calculate the total suitable area within each west coast EEZ in order to rank zones by priority. Then I will calculate the percent suitable area as well for reference.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# rasterize wc_eez\nwc_rasterized <- rasterize(wc_eez, oyster_suitability, field = 'rgn')\n\n# compute total suitable area\ntotal_suitable_area <- terra::expanse(oyster_suitability, \n                                           unit = \"km\",\n                                           zone = wc_rasterized,\n                                           transform = TRUE)\n\n# find percent suitable area\npercentage_suitable_area <- left_join(wc_eez, total_suitable_area, \n                                      by = c(\"rgn\" = \"zone\")) %>% \n  mutate(percent_suitable_area = (area / area_km2) * 100)\n```\n:::\n\n\n### Visualizing results\n\nNow, I will create maps of both total suitable area and percent suitable area for oysters by west coast EEZ regions. For aesthetics, I included a base map of all western US states. All my maps are made using the R package, ggplot2.\n\nThis is the map for total suitable area:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load in us state boundaries for aesthetics\nus_states <- st_read(\"/Users/katle/Desktop/Desktop - kat’s MacBook Air/github/species-habitability-maps/data/US_State_Boundaries/US_State_Boundaries.shp\") %>% \n  st_transform(crs = st_crs(percentage_suitable_area)) %>% \n  filter(STATE_ABBR %in% c(\"CA\", \"OR\", \"WA\", \"NV\", \"ID\", \"AZ\", \"MT\", \"UT\", \"WY\", \"CO\", \"NM\"))\n\n# create total area suitability map\ntotal_suitability_map <- ggplot() +\n  geom_sf(data = percentage_suitable_area, aes(fill = area)) +\n  geom_sf(data = us_states, fill = \"lightgrey\") +\n  geom_sf_text(data = st_centroid(us_states), aes(label = STATE_ABBR), \n              size = 3, color = \"black\") +\n  theme_linedraw() +\n  scale_fill_gradientn(colours = c(\"#ebffe4\", \"#afe09d\", \"#689d55\")) +\n  labs(title = \"Total Suitable Area for Oyster Aquaculture\",\n       subtitle = \"Organized by West Coast EEZ Regions\",\n       fill = bquote(\"Total Suitable Area (km\"^{2}~\")\"),\n       x = \"Longitude\",\n       y = \"Latitude\")\ntotal_suitability_map\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nThis is the map for percent suitable area:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create percent suitability map\npercent_suitability_map <- ggplot() +\n  geom_sf(data = percentage_suitable_area, aes(fill = percent_suitable_area)) +\n    geom_sf_text(data = st_centroid(percentage_suitable_area), \n               aes(label = round(percent_suitable_area, 2)), \n              size = 3, color = \"black\") +\n  geom_sf(data = us_states, fill = \"lightgrey\") +\n  geom_sf_text(data = st_centroid(us_states), aes(label = STATE_ABBR), \n            size = 3, color = \"black\") +\n  theme_linedraw() +\n  scale_fill_gradientn(colours = c(\"#ebffe4\", \"#afe09d\", \"#689d55\")) +\n  labs(title = \"Percent Suitable Area for Oyster Aquaculture\",\n       subtitle = \"Organized by West Coast EEZ Regions\",\n       fill = \"Percent Suitable Area (%)\",\n       x = \"Longitude\",\n       y = \"Latitude\")\npercent_suitability_map\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### Building a function to apply this workflow to other species\n\nThis is the part that I'm most excited about! Using the steps I laid out above, I created a function that will take in a species name, the suitable temperature range, and the suitable depth range. The function will output a map of both total suitable area and percent suitable area of the species that the user names. Then I stitch those maps together using the R package, patchwork. The result is a single plot with all of the information from above. Creating this function will help me reproduce the results for any species I want, which is a huge time-saver!\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creating function to apply to different species \nspecies_suitability <- function(species, temp_min, temp_max, depth_min, depth_max) {\n\n# create reclassification matrix that assigns 1 to suitable values and NA to unsuitable values\ntemp_rcl <- matrix(c(-Inf, temp_min, NA,\n                      temp_min, temp_max, 1,\n                      temp_max , Inf, NA), \n               ncol = 3, byrow = TRUE)\n\n# re-classify mean_sst with matrix above\nmean_sst_reclassified <- classify(mean_sst_celsius, rcl = temp_rcl)\n\n# create reclassification matrix for bathymetry data\ndepth_rcl <- matrix(c(-Inf, depth_min, NA,\n                      depth_min, depth_max, 1,\n                      depth_max, Inf, NA), \n               ncol = 3, byrow = TRUE)\n\n# re-classify bathymetry_cropped with matrix above\ndepth_reclassified <- classify(bathymetry_cropped, rcl = depth_rcl)\n\n# create a function to return 1 where mean_sst_reclassified and depth_reclassified are both in suitable conditions\nsuitability_fun <- function(sst, depth) {\n  return(sst*depth)\n  }\n\n# apply function to species suitability raster stack\nsuitability <- lapp(c(mean_sst_reclassified, depth_reclassified), fun = suitability_fun)\n\n# rasterize wc_eez\nwc_rasterized <- rasterize(wc_eez, suitability, field = 'rgn')\n\n# compute total suitable area\ntotal_suitable_area <- terra::expanse(suitability, \n                                           unit = \"km\",\n                                           zone = wc_rasterized,\n                                           transform = TRUE)\n\n# find percent suitable area\npercentage_suitable_area <- left_join(wc_eez, total_suitable_area, \n                                      by = c(\"rgn\" = \"zone\")) %>% \n  mutate(percent_suitable_area = (area / area_km2) * 100)\n\n# create total area suitability map\ntotal_suitability_map <- ggplot() +\n  geom_sf(data = percentage_suitable_area, aes(fill = area)) +\n  geom_sf(data = us_states, fill = \"lightgrey\") +\n  geom_sf_text(data = st_centroid(us_states), aes(label = STATE_ABBR), \n            size = 1, color = \"black\") +\n  theme_linedraw() +\n  scale_fill_gradientn(colours = c(\"#ebffe4\", \"#afe09d\", \"#689d55\")) +\n  labs(title = paste(\"Total Suitable Area for Aquaculture:\", species),\n       subtitle = expression(italic(\"Organized by West Coast EEZ Regions\")),\n       fill = bquote(\"Total Suitable Area (km\"^{2}~\")\"),\n        x = \"Longitude\",\n       y = \"Latitude\") +\n  theme(plot.title = element_text(hjust = 0.5, vjust = 1),\n        plot.subtitle = element_text(hjust = 3.25, vjust = 0.5, size = 7),\n        axis.text.x = element_text(angle = 45, vjust = 0.75, hjust = 0.75))\n\n# create percent suitability map\npercent_suitability_map <- ggplot() +\n  geom_sf(data = percentage_suitable_area, aes(fill = percent_suitable_area)) +\n    geom_sf_text(data = st_centroid(percentage_suitable_area), \n               aes(label = round(percent_suitable_area, 2)), \n              size = 3, color = \"black\") +\n  geom_sf(data = us_states, fill = \"lightgrey\") +\n  geom_sf_text(data = st_centroid(us_states), aes(label = STATE_ABBR), \n            size = 2, color = \"black\") +\n  theme_linedraw() +\n  scale_fill_gradientn(colours = c(\"#ebffe4\", \"#afe09d\", \"#689d55\")) +\n  labs(fill = \"Percent Suitable Area (%)\",\n       x = \"Longitude\",\n       y = \"Latitude\") +\n  theme(axis.text.x = element_text(angle = 45, vjust = 0.75, hjust = 0.75))\n\ntotal_suitability_map / percent_suitability_map\n\n}\n```\n:::\n\n\nFinally, I'll use the function I created to produce species suitability maps for California Rockfish.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# testing function!\nspecies_suitability(\"California Rockfish\", temp_min = 12.78, temp_max = 20, depth_min = -3000, depth_max = 0)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n# Conclusion\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}